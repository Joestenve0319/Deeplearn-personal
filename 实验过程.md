实验过程：一、赛题背景
二、数据集分析
三、程序框架
1.train
2.test
四、模型选取
五、其它增强措施(优化器，训练轮数，损失函数、数据增强、)
六、融合选取得出最优方案



1. **导入库和设置环境：**
   - 禁用SSL证书验证，导入所需的库，并设置一些全局变量，如训练轮次（EPOCHES）、批量大小（BATCH_SIZE）、图像大小（IMAGE_SIZE）和设备类型（DEVICE）。
2. **数据增广设置：**
   - 使用Albumentations库定义了一系列图像增广的操作，这有助于提高模型对不同样本的鲁棒性和泛化能力。
3. **自定义数据集类：**
   - 创建了一个继承自PyTorch的`Dataset`类的自定义数据集类`TianChiDataset`，该类用于加载和处理数据。在这里，数据集类的初始化方法用于设置数据路径等参数，而`__getitem__`方法用于加载单个样本。
4. **模型定义：**
   - 使用`get_model`函数定义并返回一个DeepLabV3分割模型。该函数使用了`segmentation_models_pytorch`库中的相应模型。
5. **损失函数定义：**
   - 创建了一个自定义的Focal Loss类，然后使用`loss_fn`函数定义整体损失函数。这个损失函数结合了二元交叉熵损失和Focal Loss损失。
6. **训练数据加载和划分：**
   - 从CSV文件中加载图像和相应的掩码数据，并将数据集划分为训练集和验证集。
7. **创建数据加载器：**
   - 使用PyTorch的`DataLoader`类创建训练和验证集的数据加载器，这些加载器负责按批次加载数据。
8. **模型初始化、优化器和学习率调度器设置：**
   - 初始化DeepLabV3模型，并将其移至GPU（如果可用）。设置AdamW优化器和余弦退火学习率调度器。
9. **训练模型：**
   - 在主函数中，通过调用`run_model1`函数进行模型的训练。该函数包含了整个训练循环，包括数据加载、模型前向传播、损失计算、反向传播和优化器更新等步骤。训练过程中还会显示进度条。
10. **保存模型：**
    - 在验证集上选择验证损失最小的模型进行保存，以便在训练结束后进行模型选择和部署。



![image-20240112173312510](C:\Users\admin\AppData\Roaming\Typora\typora-user-images\image-20240112173312510.png)

1. **导入库：**
   - 从`tkinter.ttk`中导入`Notebook`。
   - 导入训练好的UNET模型的获取函数`get_model`。
   - 导入所需的其他库，如PyTorch、tqdm（进度条显示）、cv2（图像处理）、Pandas、NumPy、transforms等。
   - 导入了`ttach`库中的数据增强方法（test-time augmentation，TTA）。
2. **设置全局变量：**
   - 定义图像大小（`IMAGE_SIZE`）和设备类型（`DEVICE`）。
3. **图像预处理函数定义：**
   - 定义了一个图像预处理的Compose，包括转换为PIL图像、调整大小、转换为张量、归一化等步骤。
4. **Run-Length Encoding（RLE）编码和解码函数定义：**
   - 定义了RLE编码和解码函数，用于将模型输出的二值掩码转换为提交文件中所需的字符串格式。
5. **模型推理及生成提交文件：**
   - 加载训练好的UNET模型，并移至GPU或CPU。
   - 使用`tta`库中的数据增强方法对模型进行测试时增强（TTA）。
   - 读取测试集图像的文件路径，并逐一处理：
     - 读取图像，进行预处理，将其送入模型进行推理。
     - 对模型输出进行二值化，得到最终的分割掩码。
     - 将分割掩码进行RLE编码，生成提交文件的一行。
   - 将生成的提交文件保存为CSV格式。
6. **可视化展示：**
   - 使用Matplotlib绘制两张子图，展示一个样本的原始图像和对应的分割掩码。

![image-20240112174647990](C:\Users\admin\AppData\Roaming\Typora\typora-user-images\image-20240112174647990.png)